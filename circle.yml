#
# CircleCI configuration
#

# Only build 'master' for now
general:
  branches:
    only:
      - master

# Ensure the database is set up before testing
database:
  override:
    - ./bin/rake db

# Show all test code
test:
  override:
    - ./bin/rspec --format=documentation

# Deploy all pushes to staging which pass tests, and deploy all pushed
# tags to production.
deployment:
  staging:
    branch: master
    commands:
      - ./bin/deploy CHEF_ENV=staging
  production:
    branch: /\Av(\d+)\.(\d+)\.(\d+)\Z/
    commands:
      - ./bin/deploy CHEF_ENV=production
